<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verbum Diei • Douay-Rheims</title>

  <!-- Dark Academia-ish typography (safe fallbacks if Google Fonts blocked) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600&family=IM+Fell+English+SC&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0b0b0d;
      --paper: #141315;
      --ink: #e8e2d6;
      --muted: #b7ad9c;
      --rule: rgba(232,226,214,.12);
      --accent: #c3a46f;  /* “golden” parchment */
      --shadow: rgba(0,0,0,.55);
    }

    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(195,164,111,.08), transparent 60%),
                  radial-gradient(900px 500px at 80% 0%, rgba(232,226,214,.05), transparent 55%),
                  var(--bg);
      color: var(--ink);
      font-family: "EB Garamond", Georgia, serif;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }

    .card{
      width: min(860px, 96vw);
      background:
        linear-gradient(180deg, rgba(255,255,255,.04), transparent 55%),
        var(--paper);
      border: 1px solid var(--rule);
      border-radius: 18px;
      box-shadow: 0 20px 60px var(--shadow);
      overflow:hidden;
    }

    .header{
      padding: 18px 22px 12px 22px;
      border-bottom: 1px solid var(--rule);
      display:flex;
      gap: 12px;
      align-items:baseline;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .title{
      font-family: "IM Fell English SC","EB Garamond", serif;
      letter-spacing: .06em;
      font-size: 18px;
      color: var(--ink);
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .title .cross{
      color: var(--accent);
      font-size: 18px;
      transform: translateY(-1px);
    }

    .meta{
      color: var(--muted);
      font-size: 14px;
      letter-spacing:.02em;
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .pill{
      border:1px solid var(--rule);
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.12);
    }

    .body{
      padding: 18px 22px 22px 22px;
    }

    .ref{
      color: var(--accent);
      font-weight: 600;
      font-size: 16px;
      letter-spacing:.01em;
      margin: 0 0 10px 0;
    }

    .verse{
      font-size: 20px;
      line-height: 1.45;
      margin: 0 0 14px 0;
    }

    .footer{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      padding-top: 12px;
      border-top: 1px solid var(--rule);
      color: var(--muted);
      font-size: 13px;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    /* Fallback iframe */
    .fallback{
      margin-top: 14px;
      border: 1px solid var(--rule);
      border-radius: 12px;
      overflow:hidden;
      background: rgba(0,0,0,.18);
    }
    iframe{
      width:100%;
      height: 300px;
      border:0;
      background: transparent;
    }

    .loading{
      color: var(--muted);
      font-style: italic;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="article" aria-label="Versículo do dia">
      <div class="header">
        <div class="title"><span class="cross">✟</span>Verbum Diei</div>
        <div class="meta">
          <span class="pill" id="today">—</span>
          <span class="pill">Douay-Rheims (DRA)</span>
        </div>
      </div>

      <div class="body">
        <p class="ref" id="ref">Carregando…</p>
        <p class="verse" id="text"><span class="loading">Obtendo o “Verse of the Day” do BibleGateway…</span></p>

        <div class="footer">
          <span>Fonte: <a id="sourceLink" href="https://www.biblegateway.com" target="_blank" rel="noopener">BibleGateway</a></span>
          <span id="status">—</span>
        </div>

        <!-- If BG blocks fetch (CORS) or fails, we show an iframe fallback -->
        <div class="fallback" id="fallback" style="display:none;">
          <iframe
            title="BibleGateway Verse of the Day (DRA)"
            src="https://www.biblegateway.com/votd/get?format=html&version=DRA"
            loading="lazy"
            referrerpolicy="no-referrer"
          ></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Pretty date (for your “aesthetic” header)
    const d = new Date();
    const fmt = new Intl.DateTimeFormat("pt-BR", { weekday:"long", day:"2-digit", month:"long", year:"numeric" });
    document.getElementById("today").textContent = fmt.format(d);

    // Try JSON first (clean rendering + typography). If blocked, fall back to iframe.
    const endpoint = "https://www.biblegateway.com/votd/get?format=json&version=DRA";

    const refEl = document.getElementById("ref");
    const textEl = document.getElementById("text");
    const statusEl = document.getElementById("status");
    const fallbackEl = document.getElementById("fallback");
    const sourceLink = document.getElementById("sourceLink");

    function showFallback(reason){
      statusEl.textContent = reason;
      fallbackEl.style.display = "block";
      refEl.textContent = "Versículo do Dia";
      textEl.innerHTML = "<span class='loading'>Exibição alternativa carregada abaixo.</span>";
      sourceLink.href = "https://www.biblegateway.com/votd";
    }

    (async () => {
      try {
        const res = await fetch(endpoint, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        // Typical JSON shape: { reference, text, version_id, ... } (may vary)
        const reference = data.reference || data.votd?.reference || "Versículo do Dia";
        const htmlText = data.text || data.votd?.text || "";

        if (!htmlText) throw new Error("JSON sem texto");

        refEl.textContent = reference;
        textEl.innerHTML = htmlText; // BG returns HTML with <span class="text">...
        statusEl.textContent = "Atualiza automaticamente a cada dia";
        sourceLink.href = data.url || "https://www.biblegateway.com/passage/?search=" + encodeURIComponent(reference) + "&version=DRA";
      } catch (e) {
        // Most common cause: CORS blocked by BG, or network restrictions in embeds.
        showFallback("Modo compatível (embed/iframe)");
      }
    })();
  </script>
</body>
</html>
