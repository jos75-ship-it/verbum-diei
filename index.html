<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verbum Diei • Douay-Rheims</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600&family=IM+Fell+English+SC&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #070709;
      --panel: rgba(18,17,19,.92);
      --ink: #e9e2d6;
      --muted: rgba(233,226,214,.72);
      --rule: rgba(233,226,214,.10);
      --accent: #c8ad78;
      --accent2:#9a855f;
      --shadow: rgba(0,0,0,.62);
    }

    html,body{
      height:100%;
      margin:0;
      background:
        radial-gradient(1200px 650px at 20% 10%, rgba(200,173,120,.10), transparent 60%),
        radial-gradient(900px 550px at 85% 0%, rgba(233,226,214,.06), transparent 58%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 30%),
        var(--bg);
      color: var(--ink);
      font-family: "EB Garamond", Georgia, serif;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }

    .card{
      width:min(860px, 96vw);
      border-radius: 20px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.05), transparent 55%),
        var(--panel);
      border: 1px solid var(--rule);
      box-shadow: 0 22px 70px var(--shadow);
      overflow:hidden;
      position:relative;
    }

    /* subtle “paper grain” */
    .card:before{
      content:"";
      position:absolute; inset:0;
      background-image:
        radial-gradient(rgba(255,255,255,.03) 1px, transparent 1px);
      background-size: 3px 3px;
      opacity:.18;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .header{
      position:relative;
      padding: 16px 22px 12px 22px;
      border-bottom: 1px solid var(--rule);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .title{
      font-family: "IM Fell English SC","EB Garamond", serif;
      letter-spacing:.08em;
      font-size: 18px;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .title .cross{ color: var(--accent); }

    .meta{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 14px;
    }
    .pill{
      border:1px solid var(--rule);
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }

    .body{
      position:relative;
      padding: 18px 22px 18px 22px;
    }

    .kicker{
      color: var(--accent);
      font-weight: 600;
      letter-spacing:.02em;
      font-size: 16px;
      margin: 0 0 10px 0;
    }

    .ref{
      margin: 0 0 12px 0;
      font-size: 18px;
      color: rgba(233,226,214,.92);
      font-weight: 600;
    }

    .quote{
      margin:0;
      padding: 16px 18px;
      border: 1px solid rgba(233,226,214,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }

    .verse{
      margin:0;
      font-size: 22px;
      line-height: 1.5;
      letter-spacing:.01em;
    }

    .verse:before{
      content:"“";
      color: var(--accent2);
      font-size: 38px;
      line-height: 0;
      vertical-align: -10px;
      margin-right: 6px;
      font-family: "EB Garamond", serif;
    }
    .verse:after{
      content:"”";
      color: var(--accent2);
      font-size: 38px;
      line-height: 0;
      vertical-align: -10px;
      margin-left: 6px;
      font-family: "EB Garamond", serif;
    }

    .footer{
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--rule);
      display:flex;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 13px;
    }

    a{
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px dotted rgba(200,173,120,.55);
    }
    a:hover{ border-bottom-color: rgba(200,173,120,.95); }

    .status{
      font-style: italic;
      color: rgba(233,226,214,.58);
    }

    .skeleton{
      color: rgba(233,226,214,.60);
      font-style: italic;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="article" aria-label="Versículo do dia">
      <div class="header">
        <div class="title"><span class="cross">✟</span>Verbum Diei</div>
        <div class="meta">
          <span class="pill" id="today">—</span>
          <span class="pill">Douay-Rheims (DRA)</span>
        </div>
      </div>

      <div class="body">
        <p class="kicker">Versículo do Dia</p>
        <p class="ref" id="ref">Carregando…</p>

        <div class="quote">
          <p class="verse" id="text"><span class="skeleton">Obtendo o “Verse of the Day”…</span></p>
        </div>

        <div class="footer">
          <span>Fonte: <a id="sourceLink" href="https://www.biblegateway.com/votd" target="_blank" rel="noopener">BibleGateway</a></span>
          <span class="status" id="status">—</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Data em pt-BR
    const d = new Date();
    const fmt = new Intl.DateTimeFormat("pt-BR", { weekday:"long", day:"2-digit", month:"long", year:"numeric" });
    document.getElementById("today").textContent = fmt.format(d);

    const refEl = document.getElementById("ref");
    const textEl = document.getElementById("text");
    const statusEl = document.getElementById("status");
    const sourceLink = document.getElementById("sourceLink");

    // CORS-bypass simples (Jina). Mantém a fonte BibleGateway no rodapé.
    const endpoint = "https://r.jina.ai/https://www.biblegateway.com/votd/get?format=json&version=DRA";

    function extractJson(text){
      // alguns proxys podem incluir lixo antes/depois; pegamos o primeiro JSON válido
      const start = text.indexOf("{");
      const end = text.lastIndexOf("}");
      if (start === -1 || end === -1 || end <= start) throw new Error("JSON não encontrado");
      return JSON.parse(text.slice(start, end + 1));
    }

    function stripHtml(html){
      // BibleGateway costuma devolver HTML simples com <br> e <span>.
      // Vamos preservar quebras e remover tags.
      const tmp = document.createElement("div");
      tmp.innerHTML = html
        .replace(/<br\\s*\\/?>(\\s*)/gi, "\n")
        .replace(/<\\/p>/gi, "\n\n");
      const text = tmp.textContent || tmp.innerText || "";
      return text.replace(/\n{3,}/g, "\n\n").trim();
    }

    (async () => {
      try {
        const res = await fetch(endpoint, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);

        const raw = await res.text();
        const data = extractJson(raw);

        const reference = data.reference || (data.votd && data.votd.reference) || "Versículo do Dia";
        const htmlText  = data.text || (data.votd && data.votd.text) || "";

        if (!htmlText) throw new Error("Sem texto no payload");

        refEl.textContent = reference;

        // Renderizamos como texto puro para ficar perfeitamente “dark academia”
        const clean = stripHtml(htmlText);
        textEl.textContent = clean;

        // Link do versículo (ou VOTD)
        const url = data.url || ("https://www.biblegateway.com/passage/?search=" + encodeURIComponent(reference) + "&version=DRA");
        sourceLink.href = url;

        statusEl.textContent = "Atualiza automaticamente (sem iframe).";
      } catch (e) {
        // Se mesmo o proxy falhar, ao menos não “estraga” o design
        refEl.textContent = "Não foi possível carregar hoje.";
        textEl.textContent = "Abra a fonte no link ao lado e tente recarregar.";
        statusEl.textContent = "Falha de rede/CORS.";
        sourceLink.href = "https://www.biblegateway.com/votd";
      }
    })();
  </script>
</body>
</html>
